<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ˜“å®æˆé•¿æ—¥è®°</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0ea5e9">
    
    <style>
        /* --- æ˜“å®ä¸“å±ï¼šå¤©è“è‰²ç³»ä¸»é¢˜ --- */
        :root {
            --primary-light: #e0f2fe; /* sky-100 */
            --primary-bg: #bae6fd;    /* sky-200 */
            --primary: #0ea5e9;       /* sky-500 */
            --primary-dark: #0284c7;  /* sky-600 */
            --gradient-start: #38bdf8;
            --gradient-end: #3b82f6;  /* blue-500 */
            
            --loss-bg: #ffe4e6;       /* rose-100 */
            --loss-text: #e11d48;     /* rose-600 */
            
            --expense-bg: #fef3c7;    /* amber-100 */
            --expense-text: #d97706;  /* amber-600 */
            
            --slate-50: #f8fafc;
            --slate-100: #f1f5f9;
            --slate-400: #94a3b8;
            --slate-700: #334155;
            --white: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--slate-50);
            color: var(--slate-700);
            margin: 0; padding: 0;
            padding-bottom: 40px; 
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: pan-y; 
            font-size: 15px;
        }

        /* å¸ƒå±€å·¥å…·ç±» */
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 0.5rem; }
        .p-4 { padding: 1rem; }
        .mt-2 { margin-top: 0.5rem; }
        .hidden { display: none !important; }

        /* å¤´éƒ¨æ ·å¼ (å¤©è“æ¸å˜) */
        .header-bg {
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: white;
            padding-bottom: 3rem; 
            border-bottom-left-radius: 2rem;
            border-bottom-right-radius: 2rem;
            box-shadow: 0 10px 20px -5px rgba(14, 165, 233, 0.3);
            position: relative;
        }

        .score-display { 
            font-size: 4.5rem; font-weight: 800; 
            text-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            margin: 0.5rem 0; line-height: 1; 
            transition: transform 0.2s;
        }
        
        .header-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
            border-radius: 9999px;
            padding: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer; color: white;
            display: flex; align-items: center; justify-content: center;
        }
        .header-btn:active { transform: scale(0.95); background: rgba(255, 255, 255, 0.3); }

        /* æ‚¬æµ®æ•°æ®å¡ç‰‡ */
        .floating-card {
            position: absolute; bottom: -2rem; left: 1.5rem; right: 1.5rem;
            background: white; border-radius: 1.25rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
            padding: 1rem; display: flex; justify-content: space-between;
            z-index: 10;
        }
        .stat-item { flex: 1; display: flex; flex-direction: column; align-items: center; }
        .stat-border { border-right: 1px solid var(--slate-100); }
        .stat-label { font-size: 0.75rem; color: var(--slate-400); font-weight: 700; margin-bottom: 0.2rem; }
        .stat-value { font-size: 1.25rem; font-weight: 800; }

        /* é€‰é¡¹å¡ */
        .tabs-container {
            overflow-x: auto; white-space: nowrap; padding: 0.5rem 0;
            -ms-overflow-style: none; scrollbar-width: none;
        }
        .tabs-container::-webkit-scrollbar { display: none; }
        .tab-btn {
            display: inline-block; padding: 0.6rem 1.2rem; 
            border-radius: 9999px; font-weight: 700; font-size: 0.85rem;
            margin-right: 0.5rem; transition: all 0.2s;
            border: 1px solid var(--slate-100);
            background: white; color: var(--slate-400);
        }
        .tab-btn.active { 
            background: var(--primary); color: white; 
            border-color: transparent; 
            box-shadow: 0 4px 10px -2px rgba(14, 165, 233, 0.4); 
            transform: scale(1.05);
        }

        /* æŒ‰é’®ç½‘æ ¼ */
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
        .action-btn {
            background: white; border: 2px solid var(--slate-100);
            border-radius: 1rem; padding: 1rem; 
            min-height: 100px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.1s; position: relative;
        }
        .action-btn:active { transform: scale(0.96); }
        
        /* é¢œè‰²å˜ä½“ */
        .action-btn.gain { color: var(--slate-700); }
        .action-btn.gain:active { border-color: var(--primary); background: var(--primary-light); }
        
        .action-btn.loss { color: var(--loss-text); }
        .action-btn.loss:active { border-color: var(--loss-bg); background: var(--loss-bg); }
        
        .action-btn.expense { color: var(--expense-text); }
        .action-btn.expense:active { border-color: var(--expense-bg); background: var(--expense-bg); }

        .points-badge {
            position: absolute; top: 0.75rem; right: 0.75rem;
            font-size: 0.75rem; font-weight: 900;
            padding: 0.15rem 0.5rem; border-radius: 0.5rem;
        }
        .badge-gain { background: var(--primary-light); color: var(--primary-dark); }
        .badge-loss { background: var(--loss-bg); color: var(--loss-text); }
        .badge-expense { background: var(--expense-bg); color: var(--expense-text); }

        /* å¼¹çª— */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(3px);
            z-index: 50; display: flex; align-items: center; justify-content: center; 
            opacity: 0; pointer-events: none; transition: opacity 0.2s;
        }
        .modal-overlay.show { opacity: 1; pointer-events: auto; }
        .modal-content {
            background: white; width: 85%; max-width: 320px;
            border-radius: 1.5rem; padding: 1.5rem;
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.15);
            transform: scale(0.9); transition: transform 0.2s;
            max-height: 70vh; display: flex; flex-direction: column;
        }
        .modal-overlay.show .modal-content { transform: scale(1); }

        .log-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.75rem; background: var(--slate-50); 
            border-radius: 0.75rem; margin-bottom: 0.5rem;
        }

        /* æç¤ºæ¡† */
        .toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
            background: white; padding: 1rem 1.5rem;
            border-radius: 1rem; box-shadow: 0 20px 30px -5px rgba(0, 0, 0, 0.15);
            font-weight: 800; font-size: 1.1rem; z-index: 100;
            display: flex; align-items: center; gap: 0.5rem;
            opacity: 0; pointer-events: none; transition: all 0.2s;
        }
        .toast.show { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        .toast.gain { color: var(--primary); border: 2px solid var(--primary-light); }
        .toast.loss { color: var(--loss-text); border: 2px solid var(--loss-bg); }
        
        /* å›¾æ ‡ SVG */
        .icon { width: 20px; height: 20px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
    </style>
</head>
<body onclick="void(0)"> <!-- iOS active fix -->

    <!-- 1. å¤´éƒ¨åŒºåŸŸ -->
    <header class="header-bg">
        <div style="padding: 1.5rem; display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <!-- æ—¥æœŸæ˜¾ç¤ºåŒºåŸŸ -->
                <div id="headerDate" style="font-size: 0.85rem; opacity: 0.9; font-weight: 600; margin-bottom: 0.2rem; display: flex; align-items: center; gap: 0.3rem;">
                    <svg class="icon" style="width:14px; height:14px;" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                    <span>åŠ è½½ä¸­...</span>
                </div>
                <div style="font-size: 1.5rem; font-weight: 800; display: flex; align-items: center; gap: 0.5rem; letter-spacing: -0.5px;">
                    æ˜“å®æˆé•¿æ—¥è®°
                    <span id="lockIcon" onclick="toggleAdmin()" style="opacity: 0.6; cursor: pointer; font-size: 1.2rem;">ğŸ”’</span>
                </div>
            </div>
            <button class="header-btn" onclick="openHistory()">
                <svg class="icon" viewBox="0 0 24 24"><path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/><path d="M12 7v5l4 2"/></svg>
            </button>
        </div>

        <div class="flex flex-col items-center">
            <div id="totalScore" class="score-display">0</div>
            <div style="font-size: 0.8rem; background: rgba(0,0,0,0.1); padding: 0.3rem 1rem; border-radius: 9999px; font-weight: 600;">å½“å‰æ€»ç§¯åˆ†</div>
        </div>

        <div class="floating-card">
            <div class="stat-item stat-border">
                <span class="stat-label">ä»Šæ—¥å‡€å¢</span>
                <span id="todayNet" class="stat-value" style="color: var(--primary);">+0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">è¿ç»­è¡¨ç°</span>
                <span id="daysStreak" class="stat-value" style="color: #f59e0b;">0 <span style="font-size: 0.8rem; font-weight:400; color:#cbd5e1;">å¤©</span></span>
            </div>
        </div>
    </header>

    <!-- 2. ä¸»ä½“åŒºåŸŸ -->
    <main style="max-width: 480px; margin: 3rem auto 0; padding: 1rem;">
        
        <!-- æƒé™æç¤º -->
        <div id="childModeTip" style="background: #fffbeb; color: #b45309; border: 1px solid #fef3c7; padding: 0.8rem; border-radius: 0.75rem; font-size: 0.8rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
            <svg class="icon" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            å½“å‰ä¸ºã€å­©å­æ¨¡å¼ã€‘ï¼Œåªèƒ½çœ‹ä¸èƒ½åˆ å“¦ã€‚
        </div>

        <!-- é€‰é¡¹å¡ -->
        <div class="tabs-container" id="categoryTabs"></div>

        <!-- æŒ‰é’®ç½‘æ ¼ -->
        <div id="actionGrid" class="grid-2 mt-2"></div>
    </main>

    <!-- 3. å†å²è®°å½•å¼¹çª— -->
    <div id="historyModal" class="modal-overlay" onclick="if(event.target===this) closeModal('historyModal')">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 style="margin:0; font-weight:800; font-size: 1.1rem; display:flex; align-items:center; gap:0.5rem;">
                    <svg class="icon" style="color:var(--primary);" viewBox="0 0 24 24"><path d="M12 8v4l3 3"/><circle cx="12" cy="12" r="10"/></svg>
                    æœ€è¿‘è®°å½•
                </h3>
                <button onclick="closeModal('historyModal')" style="background:none; border:none; color:var(--slate-400); font-size:1.5rem;">&times;</button>
            </div>
            
            <div id="historyList" style="overflow-y: auto; flex: 1; padding-right: 0.25rem;"></div>
            
            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--slate-100);">
                <button onclick="resetData()" style="width:100%; padding: 0.8rem; border-radius: 0.75rem; border: 1px solid #fda4af; color: #e11d48; background: #fff1f2; font-weight: 700;">é‡ç½®æ‰€æœ‰æ•°æ®</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // --- æ ¸å¿ƒé…ç½® (æ˜“å®ä¸“å±) ---
        const CONFIG = {
            storageKey: 'yibao_html_v2', // å‡çº§ç‰ˆæœ¬å·ä»¥é˜²å†²çª
            categories: [
                {
                    id: 'daily', title: 'æ—¥å¸¸ä¹ æƒ¯',
                    items: [
                        { label: 'è‡ªä¸»åƒé¥­', points: 5, type: 'gain', icon: 'ğŸš' },
                        { label: 'ä¸»åŠ¨æ‰“æ‹›å‘¼', points: 2, type: 'gain', icon: 'ğŸ‘‹' },
                        { label: 'æŒ‰æ—¶ç¡è§‰', points: 5, type: 'gain', icon: 'ğŸ›Œ' },
                        { label: 'åˆ·ç‰™æ´—è„¸', points: 2, type: 'gain', icon: 'ğŸª¥' },
                        { label: 'è‡ªä¸»å¦‚å•', points: 2, type: 'gain', icon: 'ğŸš½' },
                        { label: 'æ•´ç†ä¸œè¥¿', points: 5, type: 'gain', icon: 'ğŸ§º' },
                        { label: 'ä¹±ä¸¢ä¸œè¥¿', points: -10, type: 'loss', icon: 'ğŸ—‘ï¸' },
                        { label: 'åƒæ‰‹', points: -5, type: 'loss', icon: 'ğŸ‘„' }
                    ]
                },
                {
                    id: 'skills', title: 'æŠ€èƒ½å­¦ä¹ ',
                    items: [
                        { label: 'å­¦è‹±è¯­', points: 5, type: 'gain', icon: 'ğŸ”¤' },
                        { label: 'ä¸Šæ¸¸æ³³è¯¾', points: 10, type: 'gain', icon: 'ğŸŠ' },
                        { label: 'ä¸Šç¯®çƒè¯¾', points: 5, type: 'gain', icon: 'ğŸ€' },
                        { label: 'æ•´ç†ä¹¦æ¶', points: 5, type: 'gain', icon: 'ğŸ“š' }
                    ]
                },
                {
                    id: 'behavior', title: 'è¡Œä¸ºè¡¨ç°',
                    items: [
                        { label: 'å—åˆ°è¡¨æ‰¬', points: 5, type: 'gain', icon: 'ğŸŒŸ' },
                        { label: 'å¸®åŠ©ä»–äºº', points: 5, type: 'gain', icon: 'ğŸ¤' },
                        { label: 'åŠæ—¶é“æ­‰', points: 10, type: 'gain', icon: 'ğŸ™‡' },
                        { label: 'å¤§åµå¤§é—¹', points: -10, type: 'loss', icon: 'ğŸ“¢' },
                        { label: 'å“­é¼»å­', points: -5, type: 'loss', icon: 'ğŸ˜¢' },
                        { label: 'å·çœ‹æ‰‹æœº', points: -20, type: 'loss', icon: 'ğŸ“±' },
                        { label: 'å°¿è£¤å­', points: -20, type: 'loss', icon: 'ğŸ‘–' },
                        { label: 'ECAè¯·å‡', points: -5, type: 'loss', icon: 'ğŸ“' },
                        { label: 'æ¬ºè´Ÿå¦¹å¦¹', points: -20, type: 'loss', icon: 'ğŸ˜¤' },
                        { label: 'æ’’è°', points: -50, type: 'loss', icon: 'ğŸ¤¥' }
                    ]
                },
                {
                    id: 'shop', title: 'ç§¯åˆ†å…‘æ¢',
                    items: [
                        { label: 'çœ‹åŠ¨ç”»ç‰‡', points: -20, type: 'expense', icon: 'ğŸ“º', note: '20åˆ†é’Ÿ' },
                        { label: 'çœ‹iPad', points: -20, type: 'expense', icon: 'ğŸ“Ÿ', note: '20åˆ†é’Ÿ' },
                        { label: 'çœ‹æ‰‹æœº', points: -20, type: 'expense', icon: 'ğŸ¤³', note: '20åˆ†é’Ÿ' },
                        { label: 'åç¢°ç¢°è½¦', points: -20, type: 'expense', icon: 'ğŸš—' },
                        { label: 'ä¹°å†°æ·‡æ·‹', points: -50, type: 'expense', icon: 'ğŸ¦' },
                        { label: 'è´­ä¹°ç©å…·', points: -50, type: 'expense', icon: 'ğŸ' }
                    ]
                }
            ]
        };

        // --- çŠ¶æ€ç®¡ç† ---
        let state = {
            logs: [],
            activeTab: 'daily',
            isAdmin: true // é»˜è®¤å®¶é•¿æ¨¡å¼ï¼Œç‚¹å‡»é”å›¾æ ‡åˆ‡æ¢
        };

        // --- åˆå§‹åŒ– ---
        function init() {
            const saved = localStorage.getItem(CONFIG.storageKey);
            if (saved) {
                try { state.logs = JSON.parse(saved); } catch(e) {}
            }
            renderTabs();
            renderApp();
            // å¯åŠ¨æ—¶æ›´æ–°ä¸€æ¬¡æ—¥æœŸ
            updateHeaderDate();
        }

        function saveData() {
            localStorage.setItem(CONFIG.storageKey, JSON.stringify(state.logs));
            renderApp();
        }

        // --- ä¸šåŠ¡é€»è¾‘ ---
        function addLog(item) {
            if (!state.isAdmin && (item.type === 'gain' || item.type === 'expense')) {
                // æš‚æ—¶ä¸æ‹¦æˆª
            }

            const log = {
                id: Date.now(),
                label: item.label,
                points: item.points,
                type: item.type,
                icon: item.icon,
                timestamp: new Date().toISOString(),
                dateStr: new Date().toISOString().split('T')[0]
            };
            
            state.logs.unshift(log);
            saveData();
            showToast(`${item.icon} ${item.label} ${item.points>0?'+':''}${item.points}`, item.type);
            
            if(navigator.vibrate) navigator.vibrate(50); // éœ‡åŠ¨åé¦ˆ
        }

        function deleteLog(id) {
            if (!state.isAdmin) {
                showToast('è¯·è®©çˆ¸çˆ¸å¦ˆå¦ˆæ“ä½œ', 'loss');
                return;
            }
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                state.logs = state.logs.filter(l => l.id !== id);
                saveData();
                renderHistory(); // åˆ·æ–°åˆ—è¡¨
            }
        }

        function toggleAdmin() {
            state.isAdmin = !state.isAdmin;
            document.getElementById('lockIcon').textContent = state.isAdmin ? 'ğŸ”“' : 'ğŸ”’';
            document.getElementById('childModeTip').style.display = state.isAdmin ? 'none' : 'flex';
            showToast(state.isAdmin ? 'å®¶é•¿æ¨¡å¼å·²è§£é”' : 'å·²åˆ‡æ¢ä¸ºå­©å­æ¨¡å¼', 'gain');
        }

        // --- æ¸²æŸ“é€»è¾‘ ---
        function updateHeaderDate() {
            const now = new Date();
            // æ ¼å¼åŒ–æ—¥æœŸï¼š10æœˆ27æ—¥ æ˜ŸæœŸäº”
            const options = { month: 'long', day: 'numeric', weekday: 'long' };
            const dateStr = now.toLocaleDateString('zh-CN', options);
            document.getElementById('headerDate').querySelector('span').textContent = dateStr;
        }

        function renderApp() {
            // æ¯æ¬¡æ¸²æŸ“éƒ½æ ¡å‡†æ—¥æœŸ
            updateHeaderDate();

            // 1. è®¡ç®—æ€»åˆ†
            const total = state.logs.reduce((acc, l) => acc + l.points, 0);
            document.getElementById('totalScore').textContent = total;

            // 2. ä»Šæ—¥å‡€å¢
            const todayStr = new Date().toISOString().split('T')[0];
            const todayLogs = state.logs.filter(l => l.dateStr === todayStr);
            const net = todayLogs.reduce((acc, l) => acc + l.points, 0);
            document.getElementById('todayNet').textContent = (net > 0 ? '+' : '') + net;
            document.getElementById('todayNet').style.color = net >= 0 ? 'var(--primary)' : 'var(--loss-text)';

            // 3. è¿ç»­è¡¨ç° (Streak)
            let streak = 0;
            const sortedLogs = [...state.logs].sort((a,b) => new Date(b.timestamp) - new Date(a.timestamp));
            const lastLoss = sortedLogs.find(l => l.type === 'loss');
            
            if (!lastLoss) {
                if (state.logs.length > 0) {
                    const firstLog = sortedLogs[sortedLogs.length-1];
                    const diff = new Date() - new Date(firstLog.timestamp);
                    streak = Math.floor(diff / (1000 * 60 * 60 * 24)) + 1;
                }
            } else {
                const diff = new Date() - new Date(lastLoss.timestamp);
                streak = Math.floor(diff / (1000 * 60 * 60 * 24));
            }
            document.getElementById('daysStreak').innerHTML = `${streak} <span style="font-size: 0.8rem; font-weight:400; color:#cbd5e1;">å¤©</span>`;

            renderGrid();
        }

        function renderTabs() {
            const container = document.getElementById('categoryTabs');
            container.innerHTML = '';
            CONFIG.categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = `tab-btn ${state.activeTab === cat.id ? 'active' : ''}`;
                btn.textContent = cat.title;
                btn.onclick = () => {
                    state.activeTab = cat.id;
                    renderTabs(); // é‡ç»˜Tabsé«˜äº®
                    renderGrid(); // é‡ç»˜ç½‘æ ¼
                };
                container.appendChild(btn);
            });
        }

        function renderGrid() {
            const container = document.getElementById('actionGrid');
            container.innerHTML = '';
            const cat = CONFIG.categories.find(c => c.id === state.activeTab);
            if (!cat) return;

            cat.items.forEach(item => {
                const btn = document.createElement('div');
                btn.className = `action-btn ${item.type}`;
                
                let badgeClass = item.type === 'gain' ? 'badge-gain' : (item.type === 'loss' ? 'badge-loss' : 'badge-expense');
                
                btn.innerHTML = `
                    <div class="points-badge ${badgeClass}">${item.points > 0 ? '+' : ''}${item.points}</div>
                    <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">${item.icon}</div>
                    <div style="font-weight: 700; font-size: 0.9rem;">${item.label}</div>
                    ${item.note ? `<div style="font-size: 0.7rem; color: var(--slate-400); margin-top:0.2rem;">${item.note}</div>` : ''}
                `;
                btn.onclick = () => addLog(item);
                container.appendChild(btn);
            });
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            if (state.logs.length === 0) {
                list.innerHTML = '<div style="text-align:center; padding:2rem; color:var(--slate-400);">æš‚æ— è®°å½•</div>';
                return;
            }

            state.logs.slice(0, 50).forEach(log => {
                const el = document.createElement('div');
                el.className = 'log-item';
                const time = new Date(log.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const color = log.type === 'gain' ? 'var(--primary)' : (log.type === 'loss' ? 'var(--loss-text)' : 'var(--expense-text)');
                
                el.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span style="font-size:1.5rem">${log.icon}</span>
                        <div>
                            <div style="font-weight:700; font-size:0.9rem; color:var(--slate-700)">${log.label}</div>
                            <div style="font-size:0.7rem; color:var(--slate-400)">${log.dateStr} ${time}</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span style="font-weight:800; color:${color}">${log.points > 0 ? '+' : ''}${log.points}</span>
                        ${state.isAdmin ? `<button onclick="deleteLog(${log.id})" style="border:none; background:none; color:#cbd5e1; font-size:1.2rem;">&times;</button>` : ''}
                    </div>
                `;
                list.appendChild(el);
            });
        }

        function resetData() {
            if(confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿä¸å¯æ¢å¤ï¼')) {
                state.logs = [];
                saveData();
                closeModal('historyModal');
                showToast('æ•°æ®å·²é‡ç½®', 'loss');
            }
        }

        // --- äº¤äº’è¾…åŠ© ---
        function openHistory() { renderHistory(); document.getElementById('historyModal').classList.add('show'); }
        function closeModal(id) { document.getElementById(id).classList.remove('show'); }
        function showToast(msg, type) {
            const t = document.getElementById('toast');
            t.className = `toast show ${type}`;
            t.innerHTML = msg;
            setTimeout(() => t.classList.remove('show'), 1500);
        }

        // å¯åŠ¨
        init();
        // é»˜è®¤éšè—å­©å­æ¨¡å¼æç¤º
        document.getElementById('childModeTip').style.display = 'none';

    </script>
</body>
</html>